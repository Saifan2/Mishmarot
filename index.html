<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>לוח משמרות</title>
<style>
  body { font-family:"Segoe UI",sans-serif; background:#f3f6fb; color:#333; margin:0; text-align:center; }
  header { margin-top:20px; }
  .calendar { width:95%; max-width:900px; background:#fff; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.1); margin:20px auto; overflow:hidden; }
  .calendar-header { display:flex; justify-content:space-between; align-items:center; background:#0078d7; color:white; padding:15px; flex-wrap:wrap; }
  .calendar-header select, .calendar-header button { margin:5px; padding:8px 12px; border-radius:6px; border:none; font-size:16px; cursor:pointer; }
  .calendar-header button { background: rgba(255,255,255,0.2); color:white; }
  .calendar-header button:hover { background: rgba(255,255,255,0.35); }
  .calendar-grid { display:grid; grid-template-columns:repeat(7,1fr); text-align:center; }
  .day-name { background:#e0e6ef; padding:10px 0; font-weight:bold; }
  .day { border:1px solid #eee; min-height:100px; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; }
  .day.today { background:#d0e8ff; box-shadow: inset 0 0 0 2px #0078d7; }
  .shift { margin-top:5px; font-size:14px; padding:4px 8px; border-radius:6px; color:white; }
  .morning { background:#4caf50; }
  .noon { background:#ff9800; }
  .night { background:#3f51b5; }
  .off { background:#9e9e9e; }
  .weekend { background:#f0f8ff; }
  .holiday { margin-top:5px; font-size:12px; color:#555; font-weight:bold; }
</style>
</head>
<body>
<header>
  <h1>לוח משמרות</h1>
  <p>התחלה: 31/10/2025 — בוקר ראשון</p>
</header>

<div class="calendar">
  <div class="calendar-header">
    <button id="prev">&lt; חודש קודם</button>
    <div>
      <select id="month-select"></select>
      <select id="year-select"></select>
      <button id="go">צפה</button>
    </div>
    <button id="next">חודש הבא &gt;</button>
  </div>
  <div class="calendar-grid" id="calendar-grid"></div>
</div>

<script>
// --- משמרות ---
const startDate = new Date(Date.UTC(2025,9,31)); // 31/10/2025
const pattern = [
  ...Array(4).fill("בוקר"),
  ...Array(3).fill("צהריים"),
  ...Array(4).fill("לילה"),
  "צהריים",
  ...Array(4).fill("חופש")
];
const totalCycle = pattern.length;

// --- משתנה גלובלי לנתוני Hebcal ---
let hebcalData = [];

// --- טעינת נתוני חגים מ-Hebcal (ללא פרשות) ---
async function loadHebcalData(year) {
  const url = `https://www.hebcal.com/hebcal?v=1&cfg=json&maj=on&min=on&nx=on&year=${year}&month=x&ss=on&mf=on&c=off&geo=none&lg=he`;
  try {
    const response = await fetch(url);
    hebcalData = await response.json();
  } catch (error) {
    console.error('שגיאה בטעינת נתוני Hebcal:', error);
  }
}

// --- חודשים ושנים ---
const monthSelect = document.getElementById("month-select");
const yearSelect = document.getElementById("year-select");
for(let m=0;m<12;m++){
  const opt=document.createElement("option");
  opt.value=m;
  opt.text=new Intl.DateTimeFormat('he-IL',{month:'long'}).format(new Date(2000,m,1));
  monthSelect.appendChild(opt);
}
const currentYear = new Date().getFullYear();
for(let y=currentYear-5; y<=currentYear+10; y++){
  const opt=document.createElement("option");
  opt.value=y;
  opt.text=y;
  yearSelect.appendChild(opt);
}

// --- הצגת לוח ---
const grid = document.getElementById("calendar-grid");
let currentMonth = new Date().getMonth();
let currentYearSelected = new Date().getFullYear();

function renderCalendar(month, year){
  grid.innerHTML="";
  const today = new Date();
  const firstDay = new Date(Date.UTC(year,month,1));
  const daysInMonth = new Date(Date.UTC(year,month+1,0)).getUTCDate();

  const dayNames = ["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"];
  dayNames.forEach(d=>{
    const el=document.createElement("div");
    el.className="day-name";
    el.textContent=d;
    grid.appendChild(el);
  });

  const startDay = firstDay.getUTCDay(); // ראשון=0
  for(let i=0;i<startDay;i++){
    grid.appendChild(document.createElement("div"));
  }

  for(let day=1;day<=daysInMonth;day++){
    const date = new Date(Date.UTC(year,month,day));
    const dayDiv = document.createElement("div");
    dayDiv.className="day";
    if(today.getUTCDate()===day && today.getUTCMonth()===month && today.getUTCFullYear()===year){
      dayDiv.classList.add("today");
    }

    // סימון סופ"ש
    const weekDay = date.getUTCDay();
    if(weekDay===5 || weekDay===6) dayDiv.classList.add("weekend"); // שישי/שבת

    // משמרת
    const diffDays = Math.floor((date - startDate)/(1000*60*60*24));
    let shiftText="", shiftClass="off";
    if(diffDays>=0){
      const shiftType = pattern[diffDays % totalCycle];
      shiftText=shiftType;
      if(shiftType==="בוקר") shiftClass="morning";
      else if(shiftType==="צהריים") shiftClass="noon";
      else if(shiftType==="לילה") shiftClass="night";
      else shiftClass="off";
    }

    // חג (ללא פרשות)
    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    const holiday = hebcalData.items?.find(item => item.date === dateStr)?.title || '';

    dayDiv.innerHTML = `<div class="date">${day}</div>
                        <div class="shift ${shiftClass}">${shiftText}</div>
                        <div class="holiday">${holiday}</div>`;
    grid.appendChild(dayDiv);
  }
}

// --- ניווט ---
async function updateCalendar(){
  monthSelect.value=currentMonth;
  yearSelect.value=currentYearSelected;
  await loadHebcalData(currentYearSelected); // טען נתונים עבור השנה הנוכחית
  renderCalendar(currentMonth, currentYearSelected);
}

// --- הפעלה ראשונית ---
document.addEventListener('DOMContentLoaded', updateCalendar);

// --- אירועי ניווט ---
document.getElementById("prev").onclick = async () => {
  currentMonth--;
  if(currentMonth<0){currentMonth=11; currentYearSelected--;}
  await updateCalendar();
};
document.getElementById("next").onclick = async () => {
  currentMonth++;
  if(currentMonth>11){currentMonth=0; currentYearSelected++;}
  await updateCalendar();
};
document.getElementById("go").onclick = async () => {
  currentMonth=parseInt(monthSelect.value);
  currentYearSelected=parseInt(yearSelect.value);
  await updateCalendar();
};
</script>
</body>
</html>
